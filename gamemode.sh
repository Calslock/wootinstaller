#!/bin/bash
# Author: Calslock
# Version 0.3g

STEAM="~/.local/share/Steam"

# Install controller template
templateURL="https://raw.githubusercontent.com/Calslock/wootinstaller/gamemode-autoconf/autoconf/wootility_controller_config.vdf"
target="$STEAM/controller_base/templates/wootility_controller_config.vdf"
if ! curl -L $templateURL --output $target
then
	zenity --info --title="WootInstaller" --text="Couldn't install controller config!"
fi

## Add Wootility to Steam

configfile="$STEAM/userdata/*/config/shortcuts.vdf"

# Generate random AppID
# appid=$(od -vAn -N $((4)) -tu4 < /dev/urandom)

# Remove shortcuts.vdf delimiters
truncate -s-2 $configfile

# Add shortcut in binary
SHORTCUTBIN="\x00"

if [ "$1" = "stable" ]
then
SHORTCUTBIN="\x00\x00\x02\x61\x70\x70\x69\x64\x00\x00\x00\x00\x00\x01\x61\x70\x70\x6E\x61\x6D\x65\x00\x57\x6F\x6F\x74\x69\x6C\x69\x74\x79\x00\x01\x65\x78\x65\x00\x22\x2F\x68\x6F\x6D\x65\x2F\x64\x65\x63\x6B\x2F\x44\x65\x73\x6B\x74\x6F\x70\x2F\x57\x6F\x6F\x74\x69\x6C\x69\x74\x79\x2D\x73\x74\x61\x62\x6C\x65\x2E\x41\x70\x70\x49\x6D\x61\x67\x65\x22\x00\x01\x53\x74\x61\x72\x74\x44\x69\x72\x00\x2F\x68\x6F\x6D\x65\x2F\x64\x65\x63\x6B\x2F\x44\x65\x73\x6B\x74\x6F\x70\x2F\x00\x01\x69\x63\x6F\x6E\x00\x00\x01\x53\x68\x6F\x72\x74\x63\x75\x74\x50\x61\x74\x68\x00\x00\x01\x4C\x61\x75\x6E\x63\x68\x4F\x70\x74\x69\x6F\x6E\x73\x00\x2D\x2D\x6E\x6F\x2D\x73\x61\x6E\x64\x62\x6F\x78\x00\x02\x49\x73\x48\x69\x64\x64\x65\x6E\x00\x00\x00\x00\x00\x02\x41\x6C\x6C\x6F\x77\x44\x65\x73\x6B\x74\x6F\x70\x43\x6F\x6E\x66\x69\x67\x00\x01\x00\x00\x00\x02\x41\x6C\x6C\x6F\x77\x4F\x76\x65\x72\x6C\x61\x79\x00\x01\x00\x00\x00\x02\x4F\x70\x65\x6E\x56\x52\x00\x00\x00\x00\x00\x02\x44\x65\x76\x6B\x69\x74\x00\x00\x00\x00\x00\x01\x44\x65\x76\x6B\x69\x74\x47\x61\x6D\x65\x49\x44\x00\x00\x02\x44\x65\x76\x6B\x69\x74\x4F\x76\x65\x72\x72\x69\x64\x65\x41\x70\x70\x49\x44\x00\x00\x00\x00\x00\x02\x4C\x61\x73\x74\x50\x6C\x61\x79\x54\x69\x6D\x65\x00\x00\x00\x00\x00\x01\x46\x6C\x61\x74\x70\x61\x6B\x41\x70\x70\x49\x44\x00\x00\x00\x74\x61\x67\x73\x00\x08\x08\x08\x08"
elif [ "$1" = "beta" ]
then
SHORTCUTBIN="\x00\x00\x02\x61\x70\x70\x69\x64\x00\x00\x00\x00\x00\x01\x61\x70\x70\x6E\x61\x6D\x65\x00\x57\x6F\x6F\x74\x69\x6C\x69\x74\x79\x20\x42\x65\x74\x61\x00\x01\x65\x78\x65\x00\x22\x2F\x68\x6F\x6D\x65\x2F\x64\x65\x63\x6B\x2F\x44\x65\x73\x6B\x74\x6F\x70\x2F\x57\x6F\x6F\x74\x69\x6C\x69\x74\x79\x2D\x62\x65\x74\x61\x2E\x41\x70\x70\x49\x6D\x61\x67\x65\x22\x00\x01\x53\x74\x61\x72\x74\x44\x69\x72\x00\x2F\x68\x6F\x6D\x65\x2F\x64\x65\x63\x6B\x2F\x44\x65\x73\x6B\x74\x6F\x70\x2F\x00\x01\x69\x63\x6F\x6E\x00\x00\x01\x53\x68\x6F\x72\x74\x63\x75\x74\x50\x61\x74\x68\x00\x00\x01\x4C\x61\x75\x6E\x63\x68\x4F\x70\x74\x69\x6F\x6E\x73\x00\x2D\x2D\x6E\x6F\x2D\x73\x61\x6E\x64\x62\x6F\x78\x00\x02\x49\x73\x48\x69\x64\x64\x65\x6E\x00\x00\x00\x00\x00\x02\x41\x6C\x6C\x6F\x77\x44\x65\x73\x6B\x74\x6F\x70\x43\x6F\x6E\x66\x69\x67\x00\x01\x00\x00\x00\x02\x41\x6C\x6C\x6F\x77\x4F\x76\x65\x72\x6C\x61\x79\x00\x01\x00\x00\x00\x02\x4F\x70\x65\x6E\x56\x52\x00\x00\x00\x00\x00\x02\x44\x65\x76\x6B\x69\x74\x00\x00\x00\x00\x00\x01\x44\x65\x76\x6B\x69\x74\x47\x61\x6D\x65\x49\x44\x00\x00\x02\x44\x65\x76\x6B\x69\x74\x4F\x76\x65\x72\x72\x69\x64\x65\x41\x70\x70\x49\x44\x00\x00\x00\x00\x00\x02\x4C\x61\x73\x74\x50\x6C\x61\x79\x54\x69\x6D\x65\x00\x00\x00\x00\x00\x01\x46\x6C\x61\x74\x70\x61\x6B\x41\x70\x70\x49\x44\x00\x00\x00\x74\x61\x67\x73\x00\x08\x08\x08\x08"
fi
echo -n -e $SHORTCUTBIN >> $configfile

